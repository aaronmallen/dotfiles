#!/usr/bin/env sh

set -e

{{ if eq .packageManager "brew" -}}
# Brewfile hash: {{ include "private_dot_config/private_homebrew/Brewfile.tmpl" | sha256sum }}
command -v brew > /dev/null \
  && brew update \
  && brew bundle --file="$HOME/.config/homebrew/Brewfile" \
  && brew upgrade \
  && brew cleanup
{{ end -}}

{{ if eq .packageManager "paru" -}}
# Profile: {{ .profile }}
# Packages hash: {{ include ".chezmoidata/packages.yml" | sha256sum }}
paru -S --needed --noconfirm - <<EOF
{{ range .packages.aur.default -}}
{{ . }}
{{ end -}}
{{ range index .packages.aur .profile -}}
{{ . }}
{{ end -}}
EOF
{{ end -}}

{{ if eq .packageManager "yay" -}}
# Profile: {{ .profile }}
# Packages hash: {{ include ".chezmoidata/packages.yml" | sha256sum }}
yay -S --needed --noconfirm - <<EOF
{{ range .packages.aur.default -}}
{{ . }}
{{ end -}}
{{ range index .packages.aur .profile -}}
{{ . }}
{{ end -}}
EOF
{{ end -}}

# Mise config hash: {{ include "private_dot_config/private_mise/config.toml" | sha256sum }}
command -v mise > /dev/null \
  && mise install

ln -s $HOME/.config/agents/skills $HOME/.config/claude/skills
